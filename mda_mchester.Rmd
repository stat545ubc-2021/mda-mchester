---
title: "Mini Data Analysis (Milestone 1)"
author: "Marshall Chester"
date: "09/10/2021"
output:
  github_document:
    toc: true
    toc_depth: 2
  html_document:
    toc: true
    toc_float: true
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(datateachr)
library(tidyverse)
```

# **Introduction**

### **Purpose**

The purpose of this markdown is to complete STAT 545A Mini-Data Analysis (Milestone 1).\n

The author will:

1. Become familiar with one dataset
2. Create four questions from selected dataset
3. Write a reproducible and clear report with R Markdown

Several open-sourced datasets will be explored, and one final dataset will be visualized for research purposes. 

### **Author**

The author of this code is Marshall Chester, with open sourced data from the ```datateachr``` library.

### **Packages**

The following packages must be installed:

```{r packages}
# install.packages("devtools")
# devtools::install_github("UBC-MDS/datateachr")
```

The following libraries must be loaded:

```{r libraries}
library(datateachr)
library(tidyverse)
```

# **Milestone 1**

## **Task 1: Choose dataset**


### **Initial ranking**

1. ```flow_sample```
2. ```cancer_sample```
3. ```vancouver_trees```
4. ```apt_buildings```

### **Dataset exploration**

```{r exploration}
glimpse(flow_sample)

glimpse(cancer_sample)

glimpse(vancouver_trees)

glimpse(apt_buildings)

```

### **Dataset attributes**

Dataset | Rows | Columns | Class | Potential Research Question 
:------:|:----:|:-------:|:-----:|:-----------------|
```flow_sample``` | 218 | 7 | data.frame | Is maximum flow always within June and July?
```cancer_sample``` | 569 | 32 | data.frame | What is the average area of malignant diagnoses?
```vancouver_trees``` | 146,611 | 20 | data.frame | Which Vancouver neighbourhood has the greatest number of tree species?
```apt_buildings``` | 3,455 | 37 | data.frame | What percentage of buildings built before 2000 have air conditioning?

### **Pair down**

After viewing the data, I decided to proceed with cancer_sample and apt_buildings. These datasets are rich and include greater than 30 variables and 500 points for exploration and visualization.

### **Final decision**

I have decided to proceed with the ```cancer_sample``` dataset due to personal interest in healthcare. The dataset is robust with a significant number of variables and points for further evaluation. With subsetting, I believe this dataset is well suited for analysis of strength of association and predictive modeling.

## **Task 2: Explore dataset**

In the ```cancer_sample``` dataset, ```area_mean``` and ```radius_mean``` are continuous variables and can be explored by plotting each variable on the x and y axis, respectively. A positive, linear relationship is expected. By grouping data points with ```diagnosis``` (dichotomous variable), an interesting relationship could be seen.

### **New tibble**

The ````cancer_sample``` includes 32 unique variables. A new tibble can be created to include the variables most interesting to the author. For the purpose of model building, this parsed tibble will help to create an efficient workflow. 

```{r cancer tibble subset, fig.align = "centre"}
tibble(cancer_sample) %>% #make new tibble of interested variables
  select(diagnosis, radius_mean, perimeter_mean, area_mean, smoothness_mean, symmetry_mean)
```

### **Density plot**

Peaks within a density help to understand where the data are concentrated. In the ```cancer_sample``` dataset, the ```area_mean``` variable provides continuous data on the average area of diagnoses. A density plot can be created to visualize the concentration of values for both malignant and benign diagnoses. With this visualization, a greater understanding is available. 

```{r density plot, fig.align = "center"}
ggplot(cancer_sample, #check density plot of area_mean
       aes(area_mean, fill = diagnosis)) +
  geom_density(alpha = 0.6) +
  labs(x = "Area (Mean)", #add labels
       y = "Density",
       fill = "Diagnosis",
       caption = "Source: UCI, 1995") +
  scale_fill_discrete( #change legend titles
    limits = c("B", "M"),
                      labels = c("Benign", "Malignant"))
```

The ```area_mean``` of benign diagnoses are clustered around 500, while the ```area_mean``` of malignant diagnoses appears to potentially be bimodal clustered around 750 and 1250.

### **Create boxplot**

A boxplot can provide detailed information between dichotomous and continuous variables. In the ```cancer_sample``` dataset, diagnosis is dichotomous (malignant or benign) and ```symmetry_mean``` is continuous. A boxplot will help visualize the relationship between malignant and benign diagnoses. There may be an interesting outcome for further consideration.

```{r boxplot, fig.align = "center"}
ggplot(cancer_sample, #create boxplot between 2 variables
       aes(x = diagnosis,
           y = symmetry_mean)) +
  geom_boxplot(alpha = 0, #add transparency and change width
               width = 0.25) +
  geom_jitter(alpha = 0.3, #add transparency and change width
              width =0.25) + 
  labs(x = "Diagnosis", #add labels
       y = "Symmetry (Mean)", 
       caption = "Source: UCI, 1995") +
  scale_x_discrete(breaks = c("B","M"), #change x tick
                   labels = c("Benign", "Malignant"))
```

### **Explore relationship**

```{r scatterplot, fig.align = "center"}
ggplot(cancer_sample, #explore relationship between variables
       aes(x = area_mean,
           y = radius_mean, 
           group = diagnosis)) +
  geom_point(aes(color = diagnosis),
             size = 3, #add transparency and change size
             alpha = 0.4) +
    labs(x = "Area (Mean)", #add labels
         y = "Radius (Mean)", 
         caption = "Source: UCI, 1995") +
    scale_color_discrete(name = "Diagnosis", #change legend
                         labels=c("Benign", "Malignant")) +
    facet_wrap(~diagnosis) + #facet
  theme(strip.text.x = element_blank())
```

## **Task 3: Research Questions**

With the dataset selected and explored, four potential research questions are postulated.

1. Is ```area_mean``` a significant predictor of a malignant ```diagnosis```?\n

2. Which category of ```symmetry_mean``` (low, medium, high) has the highest mean ```area_mean``` when grouped by diagnosis?\n

3. Are ```perimeter_mean```, ```smoothness_mean```, and ```symmetry_mean``` normally distributed?\n

4. Is ```perimeter_mean``` lognormally distributed?\n

# **Milestone 2**

The focus of Milestone 2 is to address each research question through manipulating and summarizing the ```cancer_sample``` data frame.  

## **Task 1**

### **Question 1**: Is ```area_mean``` a significant predictor of a malignant diagnosis?\n

To begin, summarized characteristics of ```area_mean``` will be tabled. 

```{r malignant tibbles}
tibble(cancer_sample) %>% #make new tibble to find range by category
  select(diagnosis, area_mean) %>% #filter by malignant diagnoses
  group_by(diagnosis) %>%
  summarise(across(where(is.numeric), range)) # find range

tibble(cancer_sample) %>% #make new tibble to find mean by category
  select(diagnosis, area_mean) %>% #filter by malignant diagnoses
  group_by(diagnosis) %>%
  summarise(across(where(is.numeric), mean)) # find mean

tibble(cancer_sample) %>% #make new tibble to find median by category
  select(diagnosis, area_mean) %>% #filter by malignant diagnoses
  group_by(diagnosis) %>%
  summarise(across(where(is.numeric), median)) # find median

tibble(cancer_sample) %>% #make tibble for standard deviation by category
  select(diagnosis, area_mean) %>% #filter by malignant diagnoses
  group_by(diagnosis) %>%
  summarise(across(where(is.numeric), sd)) # find standard deviation
```

To visualize the relationship between the means of ```area_mean``` and ```diagnosis```, a boxplot will be created. 

```{r area_mean vs diagnosis boxplot, fig.align = "center"}
ggplot(cancer_sample, #visualize relationship between area and diagnosis
       aes(x = diagnosis,
           y = area_mean)) +
  geom_boxplot(aes(),
             alpha = 0.4) + 
    geom_jitter(alpha = 0.4, #customize alpha transparency
              width =0.25) + 
  labs(x = "Diagnosis", #add labels
       y = "Area (Mean)", 
       caption = "Source: UCI, 1995") +
  scale_x_discrete(breaks = c("B","M"), #change x tick
                   labels = c("Benign", "Malignant"))
```

An ANOVA test to determine the ratio of variability within and between grouped means of area_mean by diagnosis will be displayed. The summarized output will be printed.

```{r significance area_mean}
summary(aov(area_mean ~ diagnosis, data = cancer_sample)) #run ANOVA for differences of means
#f-value of 573.1 and p less than 2*10^-16
summary(lm(area_mean ~ diagnosis, data = cancer_sample)) #quantify relationship
#t-value for malignant diagnosis 23.94
```

With an F-value of 573.1 and p-value less than 0.05, there is a significant variability of group means. Furthermore, a t-value greater than 2 (t-value = 23.94, p-value < 0.05) we can say with 95% confidence that the difference in means is statistically significant. Finally, a multiple r-squared value of 0.5027 indicates that greater than 50% of the variance in the response data is explained by the model. Therefore, ```area_mean``` is a significant predictor of a malignant diagnosis. 

### **Question 2**: Which category of ```symmetry_mean``` (low, medium, high) has the highest mean area_mean?\n

To visualize the means of each category, a boxplot containing a new category of symmetry_mean will be created. 

```{r symmetry_mean category, fig.align = "center"}
cancer_sample %>% 
  mutate(category_symmetry = cut(symmetry_mean, 
                        breaks = 3,
                      labels = c("low","medium","high"))) %>%
  ggplot(aes(x = category_symmetry,
           y = area_mean)) +
  geom_boxplot(aes(),
             alpha = 0.4) +
  geom_point(aes(colour = factor(diagnosis)),
             alpha = 0.2) +
  labs(x = "Symmetry Category", #add labels
       y = "Area (Mean)", 
       caption = "Source: UCI, 1995") +
    scale_x_discrete(breaks = c("low","medium", "high"), #change x tick
                   labels = c("Low", "Medium", "High")) + 
    scale_colour_discrete(limits = c("B", "M"),
                          labels = c("Benign", "Malignant"),
                          name = "Diagnosis")
```

Therefore, it can be concluded that the category of "high" in ```symmetry_mean``` produces the highest mean ```area_mean``` across all categories.

### **Question 3**: Are ```perimeter_mean```, ```smoothness_mean```, and ```symmetry_mean``` normally distributed?\n 

To visualize the normal distribution, histograms and qq plots for each variable will be created. Different sized bins will be allocated to each histogram. 

```{r perimeter histogram, fig.align = "center"}
ggplot(cancer_sample,
       aes(perimeter_mean)) +
  geom_histogram(bins = 30) + 
    labs(x = "Perimeter (Mean)", #add labels
       y = "Count", 
       caption = "Source: UCI, 1995")
```

```{r perimeter qqplot, fig.align = "center"}
ggplot(cancer_sample,
       aes(sample = perimeter_mean)) +
  stat_qq() + stat_qq_line()
```

```{r smoothness histogram, fig.align = "center"}
ggplot(cancer_sample,
       aes(smoothness_mean)) +
  geom_histogram(bins = 25) + 
    labs(x = "Smoothness (Mean)", #add labels
       y = "Count", 
       caption = "Source: UCI, 1995")
```

```{r smoothness qqplot, fig.align = "center"}
ggplot(cancer_sample,
       aes(sample = smoothness_mean)) +
  stat_qq() + stat_qq_line()
```

```{r symmetry histogram, fig.align = "center"}
ggplot(cancer_sample,
       aes(symmetry_mean)) +
  geom_histogram(bins = 20) + 
    labs(x = "Symmetry (Mean)", #add labels
       y = "Count", 
       caption = "Source: UCI, 1995")
```

```{r symmetry qqplot, fig.align = "center"}
ggplot(cancer_sample,
       aes(sample = symmetry_mean)) +
  stat_qq() + stat_qq_line()
```

The ```perimeter_mean``` histogram appears to be lognormal with concentrated values below the mean and right skew. The qq plot appears to show non-normal deviation from the qq line. The ```smoothness_mean``` and ```symmetry_mean``` histograms appear normal with concentrated values about the mean and no skew. The qq plots show normal distribution.

### **Question 4**: Is ```perimeter_mean``` lognormally distributed?

```{r perimeter log-transformed histogram, fig.align = "center"}
ggplot(cancer_sample,
       aes(perimeter_mean,
           log = "y")) +
  geom_histogram(bins = 25) + 
  scale_y_continuous(trans = "log10") + 
    labs(x = "Perimeter (Mean)", #add labels
       y = "Count", 
       caption = "Source: UCI, 1995")
```

```{r symmetry log-transformed qqplot, fig.align = "center"}
ggplot(cancer_sample,
       aes(sample = symmetry_mean),
         scale_y_continuous(trans = "log10")) +
  stat_qq() + stat_qq_line()
```

After log transformation, the ```perimeter_mean``` histogram appears to be concentrated about the mean without skew. The log-transformed qq plot now follows a distribution more indicative of a normal distribution. Therefore, the ```perimeter_mean``` variable is log-normally distributed. 

### **Conclusions**

The research questions have been slightly altered to produce conclusive findings for Milestone 2. At this juncture, ```area_mean``` and ```symmetry_mean``` are producing the most interesting results and a further investigation into the relationship between these variables and ```diagnosis``` is most compelling to the author. To initiate this investigation, the research questions will be refined in a later section of the report.

## **Task 2**

### **Tidy Data**

All datasets should be tidy and reshaped to ensure: 

* each row is an observation
* each column is a variable
* each cell is a value

The following tibble used for the analysis of each research question is in tidy format. 

```{r cancer tibble subset original tidy, fig.align = "centre"}
tibble(cancer_sample) %>% 
  select(diagnosis, radius_mean, perimeter_mean, area_mean, smoothness_mean, symmetry_mean) %>%
  mutate(category_symmetry = cut(symmetry_mean, 
                        breaks = 3,
                      labels = c("low","medium","high")))
```

In the ```cancer_sample``` dataset, each row is an observation. Each column is a unique variable of the tumour, and each cell is a value in the form of numbers (quantitative) or strings (qualitative). In its current format, the data meets the criteria of tidy data. 

In this next example, the data will be untidied. The data will now include a new column with multiple variables, observations, and values within the ```age_sex``` column.

```{r cancer tibble subset untidy, fig.align = "centre"}
tibble(cancer_sample) %>% 
  select(diagnosis, radius_mean, perimeter_mean, area_mean, smoothness_mean, symmetry_mean) %>%
  mutate(category_symmetry = cut(symmetry_mean, 
                        breaks = 3,
                      labels = c("low","medium","high"))) %>%
  mutate(age_sex = sample(c("male","female", 18:85), size = 569, rep = TRUE)) #add untidy column 
```

The data is now tidied back to original format. 

```{r cancer tibble subset tidy, fig.align = "centre"}
tibble(cancer_sample) %>% 
  select(diagnosis, radius_mean, perimeter_mean, area_mean, smoothness_mean, symmetry_mean) %>%
  mutate(category_symmetry = cut(symmetry_mean, 
                        breaks = 3,
                      labels = c("low","medium","high"))) %>% 
  mutate(age_sex = sample(c("male","female", 18:85), size = 569, rep = TRUE)) %>%
  mutate(category_symmetry = cut(symmetry_mean, 
                        breaks = 3,
                      labels = c("low","medium","high"))) %>%
  select(-age_sex) #delete column and return to original
```
### **Select final questions**

The questions proposed in Milestone 2 are essentially for the purpose of completing Milestone 3, questions 1 and 2 will are selectd and will be refined for further analysis. For question 1, additional variables (```symmetry_mean```) will be added to create predictive models. For question 2, an analysis of the significance of the difference in means can be postulated. Model building and tests of significance between means are of the greatest interest to the author. 

**Proposed additions to questions**:

1. Are ```area_mean``` and ```symmetry_mean``` both significant predictors of a malignant diagnosis?\n

```{r cancer subset question 1 tibble, fig.align = "centre"}
tibble(cancer_sample) %>%
  mutate(-radius_mean) %>% #remove column
  select(diagnosis, area_mean, symmetry_mean) %>% # select only these variables
  filter(area_mean < 2300) %>% #eliminate potential outliers
  arrange(desc(area_mean))
```
2. Is the difference of means between the categories of ```symmetry_mean``` (low, medium, high) statistically significant?\n

```{r cancer subset question 2 tibble, fig.align = "centre"}
tibble(cancer_sample) %>%
   mutate(category_symmetry = cut(symmetry_mean, 
                        breaks = 3,
                      labels = c("low","medium","high"))) %>%
  select(diagnosis, symmetry_mean, category_symmetry) %>% # select only these variables
  filter(symmetry_mean < 0.3) %>% #eliminate potential outliers
  arrange(desc(symmetry_mean))
```
